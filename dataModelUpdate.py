datasource={
    "examPaper": {
      "title": "小微贷产品培训考试试卷",
      "sections": [
        {
          "type": "singleChoice",
          "title": "单选题（每题4分，共60分）",
          "questions": [
            {
              "id": 1,
              "content": "\"小微贷\"产品的主要依据文件不包括以下哪项？",
              "options": [
                "A. 《江苏省普惠金融发展风险补偿基金管理办法》",
                "B. 《江苏省\"小微贷\"工作方案(2025-2027年)》",
                "C. 《商业银行资本管理办法》",
                "D. 省联社有关信贷业务管理制度"
              ]
            },
            {
              "id": 2,
              "content": "\"小微贷\"产品的适用对象是？",
              "options": [
                "A. 江苏省内所有企业",
                "B. 江苏省内注册的小型、微型企业",
                "C. 全国范围内的小微企业",
                "D. 江苏省内大型企业"
              ]
            },
            {
              "id": 3,
              "content": "\"小微贷\"产品的主要用途是？",
              "options": [
                "A. 固定资产投资",
                "B. 生产经营周转",
                "C. 个人消费",
                "D. 房地产开发"
              ]
            },
            {
              "id": 4,
              "content": "以下哪个部门负责\"小微贷\"业务的审查、审批？",
              "options": [
                "A. 公司银行部",
                "B. 经办支行",
                "C. 授信审批部",
                "D. 信贷管理部"
              ]
            },
            {
              "id": 5,
              "content": "\"小微贷\"业务的管理依托于哪个平台实现？",
              "options": [
                "A. 江苏省综合金融服务平台",
                "B. 人民银行征信系统",
                "C. 银保监会监管系统",
                "D. 本行内部管理系统"
              ]
            },
            {
              "id": 6,
              "content": "小微企业的划型标准依据是？",
              "options": [
                "A. 《商业银行小微企业贷款管理办法》",
                "B. 《关于印发中小企业划型标准规定的通知》",
                "C. 《小微企业贷款风险管理办法》",
                "D. 《江苏省小微企业认定标准》"
              ]
            },
            {
              "id": 7,
              "content": "公司银行部在\"小微贷\"业务中的职责不包括？",
              "options": [
                "A. 对接风险补偿金管理机构",
                "B. 制定实施细则",
                "C. 直接办理贷款业务",
                "D. 指导支行营销拓展"
              ]
            },
            {
              "id": 8,
              "content": "信贷管理部主要负责\"小微贷\"业务的哪个环节？",
              "options": [
                "A. 营销拓展",
                "B. 贷中、贷后管理",
                "C. 审查审批",
                "D. 风险补偿"
              ]
            },
            {
              "id": 9,
              "content": "\"小微贷\"产品的实施细则是哪个版本的？",
              "options": [
                "A. 1.0版",
                "B. 2.0版",
                "C. 3.0版",
                "D. 4.0版"
              ]
            },
            {
              "id": 10,
              "content": "\"小微贷\"业务经办行包括？",
              "options": [
                "A. 江苏省内支行(含二级支行)",
                "B. 全国所有分支机构",
                "C. 仅总行营业部",
                "D. 仅一级支行"
              ]
            },
            {
              "id": 11,
              "content": "以下哪项不是\"小微贷\"产品的特点？",
              "options": [
                "A. 短期流动资金贷款",
                "B. 用于生产经营周转",
                "C. 长期固定资产贷款",
                "D. 面向小微企业"
              ]
            },
            {
              "id": 12,
              "content": "风险补偿工作主要由哪个部门协助进行？",
              "options": [
                "A. 授信审批部",
                "B. 公司银行部",
                "C. 信贷管理部",
                "D. 经办支行"
              ]
            },
            {
              "id": 13,
              "content": "\"小微贷\"产品的管理平台全称是？",
              "options": [
                "A. 江苏省普惠金融发展风险补偿基金专版",
                "B. 江苏省小微企业金融服务平台",
                "C. 江苏省银行信贷管理系统",
                "D. 江苏省金融监管平台"
              ]
            },
            {
              "id": 14,
              "content": "\"小微贷\"实施细则的制定和解释由哪个部门负责？",
              "options": [
                "A. 授信审批部",
                "B. 公司银行部",
                "C. 信贷管理部",
                "D. 风险管理部门"
              ]
            },
            {
              "id": 15,
              "content": "\"小微贷\"业务的服务对象必须位于？",
              "options": [
                "A. 本行实体经营支行辖区之内",
                "B. 江苏省内任意地区",
                "C. 长三角地区",
                "D. 全国范围内"
              ]
            }
          ]
        },
        {
          "type": "multipleChoice",
          "title": "多选题（每题4分，共20分）",
          "questions": [
            {
              "id": 16,
              "content": "\"小微贷\"产品的依据文件包括？",
              "options": [
                "A. 《江苏省普惠金融发展风险补偿基金管理办法》",
                "B. 《江苏省\"小微贷\"工作方案(2025-2027年)》",
                "C. 国家法律法规",
                "D. 省联社有关信贷业务管理制度"
              ]
            },
            {
              "id": 17,
              "content": "以下哪些部门参与\"小微贷\"业务管理？",
              "options": [
                "A. 公司银行部",
                "B. 经办支行",
                "C. 授信审批部",
                "D. 信贷管理部"
              ]
            },
            {
              "id": 18,
              "content": "\"小微贷\"产品的特点包括？",
              "options": [
                "A. 面向小微企业",
                "B. 用于生产经营周转",
                "C. 短期流动资金贷款",
                "D. 依托信息化平台管理"
              ]
            },
            {
              "id": 19,
              "content": "关于\"小微贷\"业务经办行，以下说法正确的是？",
              "options": [
                "A. 包括江苏省内支行",
                "B. 包括二级支行",
                "C. 负责贷款业务办理",
                "D. 负责风险补偿工作"
              ]
            },
            {
              "id": 20,
              "content": "\"小微贷\"业务管理涉及的主要环节包括？",
              "options": [
                "A. 营销拓展",
                "B. 审查审批",
                "C. 贷中管理",
                "D. 贷后管理"
              ]
            }
          ]
        },
        {
          "type": "trueFalse",
          "title": "判断题（每题4分，共20分）",
          "questions": [
            {
              "id": 21,
              "content": "\"小微贷\"产品可以用于房地产开发。"
            },
            {
              "id": 22,
              "content": "公司银行部是\"小微贷\"业务的牵头部门。"
            },
            {
              "id": 23,
              "content": "\"小微贷\"业务可以面向全国范围内的小微企业。"
            },
            {
              "id": 24,
              "content": "信贷管理部负责\"小微贷\"业务的贷前调查工作。"
            },
            {
              "id": 25,
              "content": "\"小微贷\"业务依托江苏省综合金融服务平台实现全流程信息化管理。"
            }
          ]
        }
      ]
    }
  }


surfaceUpdate={
  "surfaceUpdate": {
    "surfaceId": "default",
    "components": [
      {
        "id": "root",
        "component": {
          "Column": {
            "children": {
              "explicitList": ["title", "sections"]
            }
          }
        }
      },
      {
        "id": "title",
        "component": {
          "Text": {
            "text": {
              "path": "/examPaper/title"
            },
            "usageHint": "h1"
          }
        }
      },
      {
        "id": "sections",
        "component": {
          "List": {
            "direction": "vertical",
            "children": {
              "template": {
                "componentId": "section",
                "dataBinding": "/examPaper/sections"
              }
            }
          }
        }
      },
      {
        "id": "section",
        "component": {
          "Column": {
            "children": {
              "explicitList": ["sectionTitle", "questions"]
            }
          }
        }
      },
      {
        "id": "sectionTitle",
        "component": {
          "Text": {
            "text": {
              "path": "title"
            },
            "usageHint": "h2"
          }
        }
      },
      {
        "id": "questions",
        "component": {
          "List": {
            "direction": "vertical",
            "children": {
              "template": {
                "componentId": "question",
                "dataBinding": "questions"
              }
            }
          }
        }
      },
      {
        "id": "question",
        "component": {
          "Column": {
            "children": {
              "explicitList": ["questionContent", "options"]
            }
          }
        }
      },
      {
        "id": "questionContent",
        "component": {
          "Text": {
            "text": {
              "path": "content"
            },
            "usageHint": "body"
          }
        }
      },
      {
        "id": "options",
        "component": {
          "List": {
            "direction": "vertical",
            "children": {
              "template": {
                "componentId": "option",
                "dataBinding": "options"
              }
            }
          }
        }
      },
      {
        "id": "option",
        "component": {
          "Row": {
            "children": {
              "explicitList": ["optionCheckbox", "optionText"]
            }
          }
        }
      },
      {
        "id": "optionCheckbox",
        "component": {
          "CheckBox": {
            "label": {
              "literalString": ""
            },
            "value": {
              "literalBoolean": "false"
            }
          }
        }
      },
      {
        "id": "optionText",
        "component": {
          "Text": {
            "text": {
              "path": "."
            },
            "usageHint": "body"
          }
        }
      }
    ]
  }
}






# 根据surfaceUpdate 和 dataSource 生成符合 A2UI 的 dataModelUpdate。

from copy import deepcopy
import json

def generate_a2ui_data_model(surface_update, data_source):
    """
    生成完全符合 A2UI 规范的层级化 dataModelUpdate。
    关键修正：不再使用扁平的点分 Key (如 examPaper.sections)，而是生成完全嵌套的 valueMap 结构。
    """

    # --- 1. 核心递归转换器 (Recursive Converter) ---
    def to_a2ui_structure(data):
        """
        递归将 Python 数据结构转换为 A2UI 的类型化结构 (Typed Value)。
        """
        # 处理 None
        if data is None:
            return {"valueBoolean": None} # 通常映射为 null
        
        # 处理布尔值
        if isinstance(data, bool):
            return {"valueBoolean": data}
        
        # 处理数字
        if isinstance(data, (int, float)):
            return {"valueNumber": data}
        
        # 处理字符串
        if isinstance(data, str):
            return {"valueString": data}
        
        # 处理列表 (List)
        if isinstance(data, list):
            if not data:
                return {"valueArray": []}
            
            # 检查列表元素类型
            first_item = data[0]
            
            # A. 基础类型列表 -> valueArray
            if isinstance(first_item, (str, int, float, bool)):
                return {"valueArray": data}
            
            # B. 对象/字典列表 -> valueMap (Key 为索引字符串 "0", "1"...)
            # 这是 A2UI 处理对象数组的标准方式
            if isinstance(first_item, dict):
                map_list = []
                for idx, item in enumerate(data):
                    # 递归转换每个子项
                    item_typed = to_a2ui_structure(item)
                    
                    # 注意：如果子项是 dict，to_a2ui_structure 返回的是 {"valueMap": [...]}
                    # 我们需要将这个 valueMap 的内容提取出来，或者直接作为 valueMap 属性
                    # 这里 item_typed 结构如: {"valueMap": [ ...fields... ]}
                    
                    entry = {
                        "key": str(idx),
                        "valueMap": item_typed.get("valueMap", []) 
                    }
                    map_list.append(entry)
                return {"valueMap": map_list}

        # 处理字典 (Dictionary/Object) -> valueMap
        if isinstance(data, dict):
            kv_list = []
            for k, v in data.items():
                # 递归获取值的类型化结构
                typed_val = to_a2ui_structure(v)
                
                # 构建 {key: "fieldName", valueType: ...}
                entry = {"key": k}
                entry.update(typed_val)
                kv_list.append(entry)
            return {"valueMap": kv_list}
            
        # 默认回退
        return {"valueString": str(data)}

    # --- 2. 构建顶层结构 ---
    # 根据 A2UI 规范，dataModelUpdate 的 contents 应该包含根数据对象的直接子节点。
    # 我们直接遍历 dataSource 的顶层 Key。
    
    contents = []
    
    # 按照 Key 排序以保证输出确定性
    for root_key in sorted(data_source.keys()):
        root_value = data_source[root_key]
        
        # 转换值
        typed_structure = to_a2ui_structure(root_value)
        
        # 构建顶层条目
        entry = {"key": root_key}
        entry.update(typed_structure)
        contents.append(entry)

    # --- 3. 封装最终结果 ---
    result = {
        "dataModelUpdate": {
            "surfaceId": surface_update.get("surfaceUpdate", {}).get("surfaceId", "default"),
            "path": "/",  # 根路径
            "contents": contents
        }
    }
    
    return result



dateModelUpdata=generate_a2ui_data_model(surfaceUpdate, datasource)

print(json.dumps(dateModelUpdata, ensure_ascii=False))



def main(surfaceUpdata: str, dateModelUpdata: str) -> dict:
    import json
    import ast
    import re

    def parse(value: str):
        if not value or not isinstance(value, str):
            return value

        # 1️⃣ 尝试标准 JSON
        try:
            return json.loads(value)
        except Exception:
            pass

        # 2️⃣ 修复 {"key":""value""} 这种情况
        try:
            fixed = re.sub(r'""([^"]+)""', r"'\1'", value)
            return json.loads(fixed)
        except Exception:
            pass

        # 3️⃣ 尝试 Python 字面量解析（兼容单引号）
        try:
            return ast.literal_eval(value)
        except Exception:
            pass

        # 4️⃣ 兜底：直接返回原始字符串
        return value

    surface_obj = parse(surfaceUpdata)
    date_model_obj = parse(dateModelUpdata)

    return {
        "result": [
           surface_obj,
           date_model_obj
        ]
    }


result = main(surfaceUpdate, dateModelUpdata)
print(json.dumps(result["result"], ensure_ascii=False))





def main1(surfaceUpdata: str, dateModelUpdata: str) -> dict:
    import json
    import ast
    import re

    def parse(value: str):
        if not value or not isinstance(value, str):
            return value

        # 1️⃣ 尝试标准 JSON
        try:
            return json.loads(value)
        except Exception:
            pass

        # 2️⃣ 修复 JSON 字符串值内未转义的双引号，如: "valueString": ""小微贷"产品..."
        # 逻辑：找到 : 后的 "任意内容" 模式，将内部连续的 " 内容 " 转义
        try:
            # 先处理键值对中连续双引号的情况: ""内容"" -> \"内容\"
            fixed = re.sub(r':\s*""([^"]+)""', r': "\\"\1\\"', value)

            # 再处理单层未转义的情况: "内容" -> \"内容\"
            # 匹配字符串值内的引号对
            fixed = re.sub(r':\s*"([^"]*)"([^",\s}]+)"', r': "\\"\1\\" \2"', fixed)

            return json.loads(fixed)
        except Exception:
            pass

        # 3️⃣ 兼容：尝试将内部双引号转为单引号
        try:
            fixed = re.sub(r'""([^"]+)""', r"'\1'", value)
            return json.loads(fixed)
        except Exception:
            pass

        # 4️⃣ 尝试 Python 字面量解析（兼容单引号）
        try:
            return ast.literal_eval(value)
        except Exception:
            pass

        # 5️⃣ 兜底：直接返回原始字符串
        return value

    surface_obj = parse(surfaceUpdata)
    date_model_obj = parse(dateModelUpdata)
    begin_render=    {
        "beginRendering": {
            "surfaceId": "default",
            "root": "root"
        }
    }

    # 返回 Python 对象，外部调用时用 json.dumps() 输出
    return {
        "result":json.dumps([begin_render,surface_obj,date_model_obj], ensure_ascii=False)
    }



result1 = main1(surfaceUpdate, dateModelUpdata)
print(result1["result"])